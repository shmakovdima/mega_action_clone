###
createPromouter "MEGA_TS", "99T47AEC", 0
createPromouter "MEGA_BD", "4L3P4FR9", 1
createPromouter "MEGA_KH", "39RF7WA3", 2
createPromouter "MEGA_DY", "X7C43E4K", 3
createPromouter "MEGA_PA", "WJ4999TU", 4
createPromouter "MEGA_AD", "4HLC39A3", 5
createPromouter "MEGA_EK", "JDS345DS", 6
createPromouter "MEGA_KA", "77AW93MY", 7
createPromouter "MEGA_NN", "499WF3AN", 8
createPromouter "MEGA_NO", "LTH949X4", 9
createPromouter "MEGA_OM", "479WUAF9", 10
createPromouter "MEGA_RO", "M94NR7M9", 11
createPromouter "MEGA_SA", "CNA797E9", 12
createPromouter "MEGA_UF", "J44M4C3M", 13
###

cards = 
  "5008": [
    2310012166069
    2310012166051
    2310012166044
    2310012166036
    2310012166028
    2310012166010
    2310012166002
    2310012165996
    2310012165988
    2310012165970
    2310012165962
    2310012165954
    2310012165947
    2310012165939
    2310012165921
    2310012165913
    2310012165905
    2310012165897
    2310012165889
    2310012165871
    2310012165863
    2310012165855
    2310012165848
    2310012165830
    2310012165822
    2310012165814
    2310012165806
    2310012165798
    2310012165780
    2310012165772
    2310012165764
    2310012165756
    2310012165749
    2310012165731
    2310012165723
    2310012165715
    2310012165707
    2310012165699
    2310012165681
    2310012165673
    2310012165665
    2310012165657
    2310012165640
    2310012165632
    2310012165624
    2310012165616
    2310012165608
    2310012165590
    2310012165582
    2310012165574
    2310012167091
    2310012167083
    2310012167075
    2310012167059
    2310012167042
    2310012165566
    2310012165558
    2310012165541
    2310012165533
    2310012165525
    2310012165517
    2310012165509
    2310012165491
    2310012165483
    2310012165475
    2310012165467
    2310012165459
    2310012165129
    2310012165178
    2310012165160
    2310012165152
    2310012165145
    2310012165137
    2310012165293
    2310012165285
    2310012165277
    2310012165269
    2310012165251
    2310012165244
    2310012165236
    2310012165228
    2310012165210
    2310012165202
    2310012165194
    2310012165186
    2310012165442
    2310012165434
    2310012165426
    2310012165418
    2310012165400
    2310012165392
    2310012165384
    2310012165376
    2310012165368
    2310012165350
    2310012165343
    2310012165335
    2310012165327
    2310012165319
    2310012165301
    2310012166416
    2310012166408
    2310012166390
    2310012166382
    2310012166374
    2310012166366
    2310012166358
    2310012166341
    2310012166333
    2310012166325
    2310012166317
    2310012166309
    2310012166291
    2310012166283
    2310012166275
    2310012166267
    2310012166259
    2310012166242
    2310012166234
    2310012166226
    2310012166218
    2310012166200
    2310012166192
    2310012166184
    2310012166176
    2310012166168
    2310012166150
    2310012166143
    2310012166135
    2310012166127
    2310012166119
    2310012166101
    2310012166093
    2310012166085
    2310012166077
    2310012166929
    2310012166911
    2310012166895
    2310012166887
    2310012166879
    2310012166861
    2310012166853
    2310012166846
    2310012166838
    2310012166820
    2310012166812
    2310012166804
    2310012166796
    2310012166788
    2310012166770
    2310012166762
    2310012166754
    2310012166747
    2310012166739
    2310012166721
    2310012166713
    2310012166705
    2310012166697
    2310012166689
    2310012166671
    2310012166663
    2310012166655
    2310012166648
    2310012166630
    2310012166622
    2310012166614
    2310012166606
    2310012166598
    2310012166580
    2310012166572
    2310012166564
    2310012166556
    2310012166549
    2310012166531
    2310012166523
    2310012166515
    2310012166507
    2310012166499
    2310012166481
    2310012166473
    2310012166465
    2310012166457
    2310012166440
    2310012166432
    2310012166424
    2310012169196
    2310012169170
    2310012169162
    2310012169147
    2310012169139
    2310012169121
    2310012169113
    2310012169097
    2310012169089
    2310012169071
    2310012169063
    2310012169055
    2310012169048
    2310012169030
    2310012169022
    2310012169014
    2310012169006
    2310012168990
    2310012168982
    2310012168974
    2310012166994
    2310012166986
    2310012166978
    2310012166960
    2310012166952
    2310012168958
    2310012168941
    2310012168933
    2310012168925
    2310012168917
    2310012168891
    2310012168883
    2310012168859
    2310012168834
    2310012168818
    2310012168800
    2310012168792
    2310012168784
    2310012168776
    2310012168768
    2310012168750
    2310012168735
    2310012168594
    2310012168586
    2310012168578
    2310012168560
    2310012168552
    2310012168545
    2310012168537
    2310012168529
    2310012168511
    2310012168503
    2310012168495
    2310012168461
    2310012168453
    2310012168446
    2310012168727
    2310012168719
    2310012168701
    2310012168685
    2310012168677
    2310012168669
    2310012168651
    2310012168636
    2310012168628
    2310012168610
    2310012168115
    2310012168107
    2310012168339
    2310012168321
    2310012168313
    2310012168305
    2310012168271
    2310012168263
    2310012168255
    2310012168248
    2310012168230
    2310012168222
    2310012168438
    2310012168420
    2310012168412
    2310012168404
    2310012168396
    2310012168388
    2310012168370
    2310012168362
    2310012168354
    2310012168347
    2310012168099
    2310012168081
    2310012168073
    2310012168065
    2310012168057
    2310012168040
    2310012168032
    2310012168024
    2310012168016
    2310012168008
    2310012168214
    2310012168206
    2310012168198
    2310012168180
    2310012168164
    2310012168156
    2310012168149
    2310012168131
    2310012167802
    2310012167992
    2310012167984
    2310012167976
    2310012167968
    2310012167950
    2310012167943
    2310012167935
    2310012167927
    2310012167919
    2310012167901
    2310012167794
    2310012167786
    2310012167778
    2310012167760
    2310012167752
    2310012167745
    2310012167737
    2310012167729
    2310012167711
    2310012167703
    2310012167893
    2310012167885
    2310012167877
    2310012167869
    2310012167851
    2310012167844
    2310012167836
    2310012167828
    2310012167810
    2310012167695
    2310012167687
    2310012167679
    2310012167661
    2310012167653
    2310012167646
    2310012167638
    2310012167620
    2310012167612
    2310012167601
    2310012167323
    2310012167315
    2310012167307
    2310012167497
    2310012167489
    2310012167471
    2310012167463
    2310012167455
    2310012167448
    2310012167430
    2310012167422
    2310012167414
    2310012167406
    2310012167596
    2310012167588
    2310012167570
    2310012167562
    2310012167554
    2310012167547
    2310012167539
    2310012167521
    2310012167513
    2310012167505
    2310012167117
    2310012167109
    2310012167299
    2310012167281
    2310012167273
    2310012167265
    2310012167257
    2310012167240
    2310012167232
    2310012167224
    2310012167216
    2310012167208
    2310012167398
    2310012167380
    2310012167372
    2310012167364
    2310012167356
    2310012167349
    2310012167331
    2310025181717
    2310025181865
    2310025181493
    2310025181501
    2310025181519
    2310025181626
    2310012167190
    2310012167182
    2310012167174
    2310012167166
    2310012167158
    2310012167141
    2310012167133
    2310012167125
    2310012167034
    2310012167026
    2310012167018
    2310012167000
    2310023752717
    2310023988766
    2310023988774
    2310023988592
    2310023750604
    2310011995039
    2310011995724
  ]

mongoose     = require 'mongoose'
config       = require "./config.json"
async        = require "async"
# database connection
mongoose.connect(config.db.path + config.db.name)
db = mongoose.connection
db.on 'error', (err)->
  console.log "Error connection to database: ", err
db.once 'open', ()->
  console.log "Connected to db!"
  # Schemas loading
  CardModel = require('./schemas/cards.coffee').get mongoose
  changeCard = (number, owner, callback)->
    CardModel.findOne {number: number}, (err, c)->
      if !c
        console.log "No card " + number
        model = new CardModel {number: number, owner: owner}
        model.save (err)->
          console.log if err then "Card " + card_number + " already added" else "Successfully created card record "+card_number 
          callback()   
      else
        c.owner = owner
        c.save ()->
          console.log "Card " + number + " successfully changed!"
          callback()

  for i, card of cards
    async.eachSeries card, (card_number, callback)->
      changeCard card_number, i, callback